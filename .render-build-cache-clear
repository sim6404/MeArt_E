# Render Build Cache Clear - v1.0.50
# 정확한 라우트 제공과 404 오류 근본 해결: POST /api/remove-bg 구현 및 JSON 응답 통일
# 2024-12-19 26:00:00 - Render 배포 강제 트리거

정확한 라우트 제공과 404 오류를 근본적으로 해결했습니다:

1. 백엔드 정확한 라우트 구현:
   - POST /api/remove-bg 라우트 명시적 구현
   - router('/api') 아래에 '/remove-bg' 마운트
   - multer를 통한 파일 업로드 처리
   - Base64 이미지 지원
   - GET 요청은 405 Method Not Allowed로 거절

2. 모든 에러/미존재 라우트 JSON 응답 통일:
   - 404 Not Found → JSON 응답 (HTML 금지)
   - 공통 에러 핸들러 → JSON 응답 (HTML 금지)
   - "Unexpected token '<'" 오류 완전 제거
   - 프런트엔드 JSON 파싱 실패 방지

3. 서버 상태/레디니스/게이트 정비:
   - 0.0.0.0:$PORT로 즉시 listen
   - /healthz (항상 200), /readyz (503/200), /api/status (항상 200)
   - 준비 전 전역 게이트로 일반 API 503 차단
   - 화이트리스트: /healthz, /readyz, /api/status, /favicon.ico

4. 라우트 테이블 진단 기능:
   - 부팅 시 [routes] 목록 출력
   - POST /api/remove-bg 라우트 확인 가능
   - npm run routes: 라우트 실시간 점검

5. 클라이언트 호출부 강화:
   - 비-JSON 응답 시 텍스트로 에러 표시
   - 상세한 오류 메시지 제공
   - JSON 파싱 실패 시 명확한 진단

6. 의존성 추가:
   - multer: 파일 업로드 처리
   - compression: 응답 압축
   - Node.js >=18 호환성 확보

7. 해결된 문제들:
   - POST /api/remove-bg 404 → 200 OK
   - "Unexpected token '<'" → JSON 응답으로 해결
   - 라우트 미구현/오타 → 정확한 라우트 구현
   - router prefix 불일치 → /api 마운트 확인
   - 마운트 순서 문제 → 게이트/정적/404 순서 정리

8. 자체 점검 도구:
   - scripts/selftest.mjs: POST /api/remove-bg 테스트 포함
   - scripts/route-map.mjs: 라우트 실시간 점검
   - npm run selftest: 배포 전 자동 테스트

9. Render 설정 최적화:
   - Web Service(Node) 배포 확인
   - healthCheckPath: /healthz
   - Start Command: npm run start
   - 0.0.0.0:$PORT 리슨 보장

이제 정확한 라우트와 JSON 응답으로 안정적인 서버 운영이 가능합니다!